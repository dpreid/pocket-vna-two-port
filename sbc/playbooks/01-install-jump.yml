---
- name: install jump
  hosts: pvna2:pvna2pilot
  become: yes
  gather_facts: no

  tasks:

  # so we can use this playbook for update, stop the existing service
  # and ignore errors - typically only thrown if it does not exist
  - name: stop jump service
    service:
      name: jump
      state: stopped
     ignore_errors: true
     
  - name: build cmd/jump from practable/jump
    command: build.sh
    args:
      chdir: /home/pi/sources/jump/scripts/build
      
  - name: install cmd/jump to usr/local/bin
    command: cp jump /usr/local/bin
    args:
      chdir: /home/pi/sources/jump/cmd/jump

  - name: Copy jump service file
    copy:
      src: ../services/jump.service
      dest: /etc/systemd/system/jump.service
      owner: root
      group: root
      
  - name: copy jump access file
    copy: src=../../autogenerated/jump.access.{{ practable_label }} dest=/etc/practable/jump.access

  - name: copy jump token file
    copy: src=../../autogenerated/jump.token.{{ practable_label }} dest=/etc/practable/jump.token

  - name: Just force systemd to reread configs (2.4 and above)
    ansible.builtin.systemd:
      daemon_reload: yes

  - name: start jump service
    service:
      name: jump
      state: started
      enabled: true
      
  

