#!/bin/bash
# example relaytoken https://shell-access2.practable.io ~/secret/shellrelay2.pat
cd ../autogenerated

# we're relying on the jump.access files to work out what jump.token files to make
export SHELLTOKEN_LIFETIME=165456000
export SHELLTOKEN_ROLE=host
export SHELLTOKEN_SECRET=$(cat $2)
export SHELLTOKEN_CONNECTIONTYPE=shell
export SHELLTOKEN_AUDIENCE=$1

# This one needs to change for each experiment
export SHELLTOKEN_TOPIC=123
DIR=.
filename='./(\w*).\w*.(\w*)'

for i in $DIR/jump.access.*; do
	[[ $i =~ $filename ]]
	last="${BASH_REMATCH[2]}"
	out="jump.token.${last}"
	export SHELLTOKEN_TOPIC="$last"
	../bin/jump token > "$out"
done
